;=================================================
; Name: Munoz, Francisco
; Username: fmuno003    (fmuno003@ucr.edu)
; 
; Lab: LAB 05
; Lab section: 021
; TA: Bryan Marsh
; 
;=================================================
.ORIG x3000
	;==============
	;INSTRUCTIONS
	;==============
	LD R6, DEC_16
	LD R5, INPUT_BINARY_3400

	JSRR R5
	
	LEA R0, NEW_LINE
	TRAP x22
	
	HALT
	;======
	;DATA
	;======
	DEC_16				.FILL		#16
	NEW_LINE			.STRINGZ	"\n"
	INPUT_BINARY_3400		.FILL		x3400

	
	
	
	
;===============================
;SUBROUTINE: INPUT_BINARY_3400
;PARAMETER:
;POSTCONDITION:
;RETURN VALUE: REGISTER 2
;===============================
.ORIG x3400
	;=========================
	;SUBROUTINE INSTRUCTIONS
	;=========================
	ST R7, BACKUP_R7_3400
    ST R6, BACKUP_R6_3400
    ST R5, BACKUP_R5_3400
    ST R4, BACKUP_R4_3400
    ST R3, BACKUP_R3_3400
    ST R1, BACKUP_R1_3400
    ST R0, BACKUP_R0_3400
    ;===========
    ;ALGORITHM
    ;===========
DO_WHILE_LOOP	
	LEA R0, PROMPT_USER_3400
	TRAP x22
	LEA R0, NEW_LINE_3400
	TRAP x22

	LD R3, DEC_98_3400
	NOT R3, R3
	ADD R3, R3, #1

	LD R6, DEC_14_3400
	LD R5, ASCII_CONVERSION_3400
	NOT R5, R5
	ADD R5, R5, #1
	
REDIRECTION_3401
	TRAP x20
	TRAP x21
	IF_STATEMENT_3401
		ADD R4, R3, R0
		BRz CONTINUE_CODING_3401
		BRnp REDIRECTION_3400
REDIRECTION_3402
	TRAP x20
	TRAP x21
	IF_STATEMENT_3402
		ADD R4, R5, R0
		BRn SPACE_3400
		BRz CONTINUE_CODING_3400
		BRp POSITIVE_CHECK
REDIRECTION_3400
	LEA R0, NEW_LINE_3400
	TRAP x22
	LEA R0, ERROR_INPUT_3400
	TRAP x22
	LEA R0, NEW_LINE_3400
	TRAP x22

	ADD R4, R4, #0
	BRnp DO_WHILE_LOOP

CONTINUE_CODING_3400
	ADD R4, R5, R0
	BRn SPACE_3400
	BRz CONTINUE_THE_CODE_3400
	BRp	POSITIVE_CHECK

CONTINUE_CODING_3401
	TRAP x20
	TRAP x21
	ADD R4, R5, R0
	BRn SPACE_3400
	BRz CONTINUE_THE_CODE_3400
	BRp	POSITIVE_CHECK

SPACE_3400
	ADD R4, R4, #15
	ADD R4, R4, #1
	BRz REDIRECTION_3402
	BRnp DO_WHILE_LOOP

POSITIVE_CHECK
	ADD R4, R4, #-1
	BRz CONTINUE_THE_CODE_3400
	BRnp	REDIRECTION_3400

CONTINUE_THE_CODE_3400
FOR_LOOP_3400    
    TRAP x20
    TRAP x21
    
    IF_STATEMENT_3400
		ADD R1, R5, R0
		BRz ZERO_3400
		BRp ONE_3400
    
ZERO_3400    
	ADD R2, R2, R2
	ADD R2, R2, #0
	BRzp	CONTINUE_3400
ONE_3400
    ADD R2, R2, R2	
    ADD R2, R2, R1

CONTINUE_3400	
    ADD R6, R6, #-1
    BRzp FOR_LOOP_3400
    END_FOR_LOOP_3400
    
END_DO_WHILE_LOOP    
    ;=========
    ;RESTORE
    ;=========
	LD R7, BACKUP_R7_3400
    LD R6, BACKUP_R6_3400
    LD R5, BACKUP_R5_3400
    LD R4, BACKUP_R4_3400
    LD R3, BACKUP_R3_3400
    LD R1, BACKUP_R1_3400
    LD R0, BACKUP_R0_3400
	;=======
	;RETURN
	;=======
	RET
	
	;=================
	;SUBROUTINE DATA
	;=================
    BACKUP_R7_3400      	.BLKW   #1
    BACKUP_R6_3400      	.BLKW   #1
    BACKUP_R5_3400      	.BLKW   #1
    BACKUP_R4_3400      	.BLKW   #1
    BACKUP_R3_3400      	.BLKW   #1
    BACKUP_R1_3400      	.BLKW   #1
    BACKUP_R0_3400      	.BLKW   #1
	DEC_14_3400				.FILL	#14
	ASCII_CONVERSION_3400	.FILL	x30
	DEC_0_3400				.FILL	#0
	NEW_LINE_3400		.STRINGZ	"\n"
	PROMPT_USER_3400		.STRINGZ	"Please enter b followed by the 16 bit binary:"
	DEC_98_3400		.FILL		#98
	ERROR_INPUT_3400	.STRINGZ	"ERROR INVALID INPUT"
.END
